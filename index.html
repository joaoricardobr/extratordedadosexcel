<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload de Planilha</title>
  <style>
    /* Estilo Geral */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to bottom, #ffffff, #f0f8ff);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    header h1 {
      font-size: 2rem;
      margin-bottom: 20px;
    }

    /* Bot√µes */
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    button i {
      margin-right: 10px;
      font-size: 1.2rem;
      transition: transform 0.3s;
    }

    button:hover i {
      transform: perspective(500px) rotateX(20deg);
    }

    /* Tabela */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      text-align: left;
    }

    table th, table td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    table th {
      background-color: #f4f4f4;
    }

    /* Layout Responsivo */
    .options, .export-options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button {
      flex: 1 1 calc(33.33% - 20px);
      max-width: 200px;
    }

    @media (max-width: 768px) {
      button {
        flex: 1 1 100%;
        max-width: none;
      }
    }

    /* Rodap√© */
    footer {
      background-color: #f4f4f4;
      padding: 20px;
      text-align: center;
      font-size: 14px;
      margin-top: 40px;
    }

    footer a {
      color: #007bff;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Upload de Planilha</h1>
      <input type="file" id="fileInput" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" style="display: none;" />
      <button class="btn-upload" onclick="document.getElementById('fileInput').click();"><i class="icon-upload">üìÅ</i> Fa√ßa Upload de sua Planilha</button>
    </header>

    <main>
      <button class="btn-process" onclick="processData()"><i class="icon-gear">‚öôÔ∏è</i> Processar</button>
      <div class="options">
        <button class="btn-select-all" onclick="selectAll(true)"><i class="icon-check-all">‚úÖ</i> Selecionar Todos</button>
        <button class="btn-deselect-all" onclick="selectAll(false)"><i class="icon-uncheck-all">‚ùå</i> Desmarcar Todos</button>
      </div>

      <div id="table-container"></div>

      <div class="export-options">
        <button class="btn-save" data-format="json" onclick="saveFile('json')"><i class="icon-json">{}</i> Salvar como JSON</button>
        <button class="btn-save" data-format="csv" onclick="saveFile('csv')"><i class="icon-csv">üìä</i> Salvar como CSV</button>
        <button class="btn-save" data-format="excel" onclick="saveFile('excel')"><i class="icon-excel">üìã</i> Salvar como Excel</button>
        <button class="btn-save" data-format="pdf" onclick="saveFile('pdf')"><i class="icon-pdf">üìÑ</i> Salvar como PDF</button>
        <button class="btn-save" data-format="txt" onclick="saveFile('txt')"><i class="icon-txt">üìù</i> Salvar como TXT</button>
        <button class="btn-save" data-format="html" onclick="saveFile('html')"><i class="icon-html"><></i> Salvar como HTML</button>
      </div>
    </main>

    <footer>
      <p>Desenvolvido por <a href="https://joaoricardobr.github.io/meuportifolio" target="_blank">Jo√£o Ricardo</a></p>
      <p>√çcones fornecidos por <a href="https://www.flaticon.com" target="_blank">Flaticon</a></p>
      <p>Tecnologias usadas: HTML5, CSS3, JavaScript</p>
    </footer>
  </div>

  <!-- Bibliotecas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let data = []; // Dados carregados da planilha

    // Fun√ß√£o para carregar arquivo
    document.getElementById('fileInput').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const arrayBuffer = e.target.result;
        try {
          const workbook = XLSX.read(arrayBuffer, { type: 'array' });
          const sheetName = workbook.SheetNames[0]; // Primeira planilha
          data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]); // Converte para JSON
          renderTable(data);
          alert('Planilha carregada com sucesso!');
        } catch (error) {
          alert('Erro ao carregar a planilha. Certifique-se de que o formato √© v√°lido.');
        }
      };
      reader.readAsArrayBuffer(file);
    });

    // Fun√ß√£o para renderizar tabela
    function renderTable(data) {
      const container = document.getElementById('table-container');
      container.innerHTML = ''; // Limpa o conte√∫do anterior

      if (data.length === 0) {
        container.innerHTML = '<p>Nenhum dado dispon√≠vel.</p>';
        return;
      }

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const tbody = document.createElement('tbody');

      // Cabe√ßalho
      const headers = Object.keys(data[0]);
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = `<th><input type="checkbox" id="select-all"></th>`;
      headers.forEach(header => {
        headerRow.innerHTML += `<th><input type="checkbox" class="column-checkbox" data-column="${header}">${header}</th>`;
      });
      thead.appendChild(headerRow);

      // Corpo
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input type="checkbox" class="row-checkbox" data-index="${index}"></td>`;
        headers.forEach(header => {
          tr.innerHTML += `<td>${row[header]}</td>`;
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      container.appendChild(table);

      // Adiciona evento ao checkbox "Selecionar Todos"
      document.getElementById('select-all').addEventListener('change', function () {
        const allCheckboxes = document.querySelectorAll('.row-checkbox, .column-checkbox');
        allCheckboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });

      // Adiciona eventos aos checkboxes de coluna
      document.querySelectorAll('.column-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
          const column = this.getAttribute('data-column');
          const isChecked = this.checked;
          document.querySelectorAll(`td:nth-child(${headers.indexOf(column) + 2})`).forEach(cell => {
            cell.style.display = isChecked ? '' : 'none';
          });
        });
      });
    }

    // Fun√ß√£o para processar dados
    function processData() {
      const selectedRows = [];
      document.querySelectorAll('.row-checkbox:checked').forEach(checkbox => {
        const index = parseInt(checkbox.getAttribute('data-index'));
        selectedRows.push(data[index]);
      });

      if (selectedRows.length === 0) {
        alert('Nenhuma linha selecionada para processar.');
        return;
      }

      alert(`Processando ${selectedRows.length} linha(s)...`);
      console.log('Linhas processadas:', selectedRows);
    }

    // Fun√ß√£o para selecionar/desmarcar todos
    function selectAll(select) {
      const allCheckboxes = document.querySelectorAll('.row-checkbox, .column-checkbox');
      allCheckboxes.forEach((checkbox) => {
        checkbox.checked = select;
      });
    }

    // Fun√ß√£o para salvar arquivo
    function saveFile(format) {
      const selectedRows = [];
      document.querySelectorAll('.row-checkbox:checked').forEach(checkbox => {
        const index = parseInt(checkbox.getAttribute('data-index'));
        selectedRows.push(data[index]);
      });

      if (selectedRows.length === 0) {
        alert('Nenhuma linha selecionada para exportar.');
        return;
      }

      let blob;
      let fileName = `dados.${format}`;

      switch (format) {
        case 'json':
          blob = new Blob([JSON.stringify(selectedRows, null, 2)], { type: 'application/json' });
          break;
        case 'csv':
          const csvContent = XLSX.utils.json_to_sheet(selectedRows); // Converte JSON para CSV
          blob = new Blob([XLSX.write(csvContent, { bookType: 'csv', type: 'string' })], { type: 'text/csv' });
          break;
        case 'excel':
          const wb = XLSX.utils.book_new();
          const ws = XLSX.utils.json_to_sheet(selectedRows);
          XLSX.utils.book_append_sheet(wb, ws, 'Dados');
          blob = new Blob([XLSX.write(wb, { bookType: 'xlsx', type: 'array' })], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
          break;
        case 'pdf':
          const doc = new jspdf.jsPDF();
          doc.text('Dados Exportados', 10, 10);
          let yPos = 20;
          selectedRows.forEach(row => {
            doc.text(JSON.stringify(row), 10, yPos);
            yPos += 10;
          });
          doc.save(fileName);
          return;
        case 'txt':
          const txtContent = selectedRows.map(row => JSON.stringify(row)).join('\n');
          blob = new Blob([txtContent], { type: 'text/plain' });
          break;
        case 'html':
          const htmlContent = `
            <table border="1">
              <thead><tr>${Object.keys(selectedRows[0]).map(key => `<th>${key}</th>`).join('')}</tr></thead>
              <tbody>${selectedRows.map(row => `<tr>${Object.values(row).map(value => `<td>${value}</td>`).join('')}</tr>`).join('')}</tbody>
            </table>
          `;
          blob = new Blob([htmlContent], { type: 'text/html' });
          break;
        default:
          alert(`Formato ${format} ainda n√£o implementado.`);
          return;
      }

      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = fileName;
      link.click();
    }
  </script>
</body>
</html>
